<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6936643122971284"
     crossorigin="anonymous"></script>
  <title>Member Dashboard | Pecos</title>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-storage-compat.js"></script>

  <style>
    :root{--accent:#4a4a7d;--accent-2:#c33;--bg:#f9f5d7}
    body{background-color:var(--bg);font-family:Verdana,Segoe UI,Roboto,sans-serif;margin:0;padding:0}
    .container{max-width:1100px;width:95%;margin:30px auto;border:4px solid var(--accent);background-color:#fffce8;box-shadow:0 0 10px rgba(0,0,0,.12)}
    header{background-color:var(--accent);color:#fff;padding:12px 18px;display:flex;justify-content:space-between;align-items:center;gap:10px}
    header .brand{display:flex;align-items:center;gap:12px}
    header img{height:40px}
    header nav{display:flex;align-items:center;gap:12px}
    header nav a{color:#fff;text-decoration:none}

    .content{display:flex;gap:18px;padding:18px}
    .sidebar{width:260px;background:#f7f3c6;padding:12px;border-right:2px solid #ddd}
    .sidebar h3{background-color:var(--accent-2);color:white;padding:8px;text-align:center;margin:0}
    .sidebar ul{list-style:none;padding:8px;margin:8px 0}
    .sidebar li{margin:8px 0}
    .sidebar a{color:#333;text-decoration:none}

    .main{flex:1;background:#fffef0;padding:16px}
    .grid{display:grid;grid-template-columns:260px 1fr;gap:18px}

    .profile-card{background:#fff8cc;border:1px solid #ddd;padding:12px;border-radius:8px}
    .profile-photo{width:100%;height:200px;background:#eee;border-radius:6px;object-fit:cover}
    .muted{color:#666;font-size:13px}

    footer{background:var(--accent);color:#fff;text-align:center;padding:10px;margin-top:18px}
    @media(max-width:900px){.content{flex-direction:column}.sidebar{width:100%}.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <img src="https://www.pecos.in/pecos.png" alt="Pecos Logo" />
        <div>
          <div style="font-weight:700;font-size:18px">Pecos</div>
          <div style="font-size:12px;color:#fffaa0">Member dashboard</div>
        </div>
      </div>
      <nav>
        <div id="welcome-message">Checking login...</div>
        <a href="#" id="nav-logout">Logout</a>
      </nav>
    </header>

    <div class="content">
      <aside class="sidebar">
        <h3>Dashboard Menu</h3>
        <ul>
          <li><a href="#overview" onclick="showSection('overview')">Overview</a></li>
          <li><a href="#profile" onclick="showSection('profile')">Profile</a></li>
          <li><a href="#dashboard" onclick="showSection('dashboard')">Financial Dashboard</a></li>
          <li><a href="#events" onclick="showSection('events')">Events</a></li>
          <li><a href="#referrals" onclick="showSection('referrals')">Referrals</a></li>
          <li><a href="#settings" onclick="showSection('settings')">Account Settings</a></li>
        </ul>
      </aside>

      <main class="main">
        <!-- Overview -->
        <div id="overview" class="section">
          <div class="grid">
            <div class="profile-card">
              <img id="profile-photo" class="profile-photo" src="https://www.pecos.in/pecos.png" alt="Profile Photo" />
              <div style="margin-top:8px">
                <div style="font-weight:700;font-size:16px" id="profile-name">Member Name</div>
                <div class="muted" id="profile-id">Member ID: -</div>
                <div class="muted" id="profile-since">Member since: -</div>
                <div class="muted" id="profile-tokens">Total Tokens: -</div>
              </div>
              <div style="margin-top:10px;display:flex;gap:8px">
                <button onclick="showSection('profile')">View Profile</button>
              </div>
            </div>
            <div>
              <div class="card">
                <h4>Club Highlights</h4>
                <p>Stay tuned for your upcoming events and reports.</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Profile -->
        <div id="profile" class="section" style="display:none">
          <h2>Profile</h2>
          <div style="display:flex;gap:12px;flex-wrap:wrap">
            <div style="flex:1;min-width:260px">
              <img id="edit-photo-preview" src="https://www.pecos.in/pecos.png" style="width:100%;height:200px;object-fit:cover;border-radius:6px;border:1px solid #ddd" />
              <!-- Upload hidden -->
              <input type="file" id="upload-photo" accept="image/*" style="display:none" disabled />
              <p style="color:#888;font-size:13px;text-align:center;margin-top:6px;">Profile image fixed by admin</p>
            </div>
            <div style="flex:2;min-width:260px">
              <div class="form-row">
                <label>Name</label>
                <input id="edit-name" type="text" />
              </div>
              <div class="form-row">
                <label>Email (readonly)</label>
                <input id="edit-email" type="email" readonly />
              </div>
              <div class="form-row">
                <label>Member ID</label>
                <input id="edit-member-id" type="text" readonly />
              </div>
              <div class="form-row">
                <label>Member Since</label>
                <input id="edit-member-since" type="text" readonly />
              </div>
              <div class="form-row">
                <label>Total Tokens</label>
                <input id="edit-tokens" type="text" readonly />
              </div>
              <div style="display:flex;gap:8px;margin-top:10px">
                <button id="save-profile">Save Profile</button>
                <button onclick="showSection('overview')">Back</button>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <footer>
      Â© 2025 Pecos | Registered in 2020
    </footer>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDnbqKwqvg9BoAjpgMBFCr3ZBOFOcuvZxs",
      authDomain: "pecos-432b5.firebaseapp.com",
      projectId: "pecos-432b5",
      storageBucket: "pecos-432b5.appspot.com"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    function $(id){return document.getElementById(id);}
    function showSection(id){
      document.querySelectorAll('.section').forEach(s=>s.style.display='none');
      const el = $(id);
      if(el) el.style.display='block';
      window.scrollTo({top:0,behavior:'smooth'});
    }

    auth.onAuthStateChanged(async user => {
      if(!user){ window.location.href='login.html'; return; }
      $('welcome-message').innerText = `Welcome, ${user.displayName || user.email}`;
      loadMemberData(user);
    });

    $('nav-logout').addEventListener('click', e=>{
      e.preventDefault();
      auth.signOut().then(()=>window.location.href='login.html');
    });

    async function loadMemberData(user){
      const doc = await db.collection('members').doc(user.uid).get();
      const data = doc.exists ? doc.data() : {};
      $('profile-name').innerText = data.displayName || user.displayName || 'Member';
      $('profile-id').innerText = 'Member ID: ' + (data.memberID || '-');
      $('profile-since').innerText = 'Member since: ' + (data.memberSince || '-');
      $('profile-tokens').innerText = 'Total Tokens: ' + (data.tokens ?? 0);
      $('edit-name').value = data.displayName || '';
      $('edit-email').value = data.email || user.email;
      $('edit-member-id').value = data.memberID || '';
      $('edit-member-since').value = data.memberSince || '';
      $('edit-tokens').value = data.tokens ?? 0;
    }

    $('save-profile').addEventListener('click', async ()=>{
      const user = auth.currentUser; if(!user) return alert('Not logged in');
      const name = $('edit-name').value.trim();
      await db.collection('members').doc(user.uid).update({displayName:name});
      await user.updateProfile({displayName:name, photoURL:"https://www.pecos.in/pecos.png"});
      alert('Profile updated successfully.');
      loadMemberData(user);
      showSection('overview');
    });
  </script>
</body>
</html>
