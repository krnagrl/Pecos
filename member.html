<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Club Pecos | Member Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Montserrat', sans-serif;
    }
    body {
      display: flex;
      min-height: 100vh;
      background: #f8f9fa;
      color: #333;
    }
    .sidebar {
      width: 230px;
      background: #111827;
      color: white;
      display: flex;
      flex-direction: column;
      padding: 20px;
    }
    .sidebar h2 {
      text-align: center;
      margin-bottom: 30px;
      font-weight: 600;
    }
    .sidebar a {
      color: white;
      text-decoration: none;
      padding: 12px 15px;
      border-radius: 8px;
      margin-bottom: 10px;
      transition: background 0.3s;
      display: block;
    }
    .sidebar a:hover, .sidebar a.active {
      background: #2563eb;
    }
    .content {
      flex: 1;
      padding: 40px;
      overflow-y: auto;
    }
    .section {
      display: none;
      animation: fadeIn 0.4s ease-in-out;
    }
    .section.active {
      display: block;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .card {
      background: white;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    .card h3 {
      margin-bottom: 15px;
    }
    .btn {
      background: #2563eb;
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 6px;
      cursor: pointer;
      transition: 0.3s;
    }
    .btn:hover {
      background: #1d4ed8;
    }
    input, textarea, select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
      margin-bottom: 12px;
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <h2>Club Pecos</h2>
    <a href="#" class="active" onclick="showSection('home')">Home</a>
    <a href="#" onclick="showSection('members')">Members</a>
    <a href="#" onclick="showSection('events')">Events</a>
    <a href="#" onclick="showSection('profile')">Profile</a>
    <a href="#" onclick="logout()">Logout</a>
  </div>

  <div class="content">
    <!-- Home Section -->
    <div id="home" class="section active">
      <h1>Welcome to Club Pecos</h1>
      <p>Your exclusive dashboard for managing membership, tokens, and events.</p>
    </div>

    <!-- Members Section -->
    <div id="members" class="section">
      <h1>Member Section</h1>

      <div class="card">
        <h3>Token Balance</h3>
        <p><strong id="tokenBalance">Loading...</strong> PECOS Tokens</p>
      </div>

      <div class="card">
        <h3>Purchase / Sell Tokens</h3>
        <select id="transactionType">
          <option value="buy">Buy Tokens</option>
          <option value="sell">Sell Tokens</option>
        </select>
        <input type="number" id="tokenAmount" placeholder="Enter number of tokens" />
        <button class="btn" onclick="handleTokenTransaction()">Submit</button>
        <p id="transactionStatus"></p>
      </div>

      <div class="card">
        <h3>Organize an Event</h3>
        <input type="text" id="eventTitle" placeholder="Event Title" />
        <textarea id="eventDesc" placeholder="Event Description"></textarea>
        <input type="date" id="eventDate" />
        <button class="btn" onclick="organizeEvent()">Create Event</button>
        <p id="eventStatus"></p>
      </div>

      <div class="card">
        <h3>Upcoming Events Calendar</h3>
        <ul id="eventList"><li>Loading events...</li></ul>
      </div>
    </div>

    <!-- Events Section -->
    <div id="events" class="section">
      <h1>Events</h1>
      <p>All Club Pecos events and announcements will appear here.</p>
    </div>

    <!-- Profile Section -->
    <div id="profile" class="section">
      <h1>Your Profile</h1>
      <div class="card">
        <p><strong>Name:</strong> <span id="userName">Loading...</span></p>
        <p><strong>Email:</strong> <span id="userEmail">Loading...</span></p>
        <p><strong>Contact:</strong> <span id="userContact">+91-XXXXXXXXXX</span></p>
      </div>
    </div>
  </div>

  <script>
    // ---------------- Firebase Config ----------------
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_BUCKET",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    // ---------------- Section Toggle ----------------
    function showSection(id) {
      document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      document.querySelectorAll('.sidebar a').forEach(a => a.classList.remove('active'));
      event.target.classList.add('active');
    }

    // ---------------- Load User Data ----------------
    let currentUser;
    auth.onAuthStateChanged(async (user) => {
      if (user) {
        currentUser = user;
        document.getElementById("userEmail").innerText = user.email;

        const userDoc = await db.collection("users").doc(user.uid).get();
        if (userDoc.exists) {
          const data = userDoc.data();
          document.getElementById("userName").innerText = data.name || "Unnamed User";
          document.getElementById("userContact").innerText = data.contact || "Not Provided";
          document.getElementById("tokenBalance").innerText = data.tokens || 0;
        } else {
          await db.collection("users").doc(user.uid).set({ tokens: 0 });
          document.getElementById("tokenBalance").innerText = 0;
        }

        loadEvents();
      } else {
        window.location.href = "login.html";
      }
    });

    // ---------------- Token Buy/Sell ----------------
    async function handleTokenTransaction() {
      const type = document.getElementById('transactionType').value;
      const amount = parseInt(document.getElementById('tokenAmount').value);
      const status = document.getElementById('transactionStatus');

      if (!amount || amount <= 0) {
        status.innerText = "⚠️ Please enter a valid amount.";
        return;
      }

      const userRef = db.collection("users").doc(currentUser.uid);
      const userSnap = await userRef.get();
      let balance = userSnap.data().tokens || 0;

      if (type === "buy") balance += amount;
      if (type === "sell" && balance >= amount) balance -= amount;
      else if (type === "sell" && balance < amount) {
        status.innerText = "❌ Not enough tokens to sell.";
        return;
      }

      await userRef.update({ tokens: balance });
      document.getElementById('tokenBalance').innerText = balance;
      status.innerText = `✅ ${type === "buy" ? "Purchased" : "Sold"} ${amount} tokens successfully.`;
    }

    // ---------------- Organize Event ----------------
    async function organizeEvent() {
      const title = document.getElementById('eventTitle').value;
      const desc = document.getElementById('eventDesc').value;
      const date = document.getElementById('eventDate').value;
      const status = document.getElementById('eventStatus');

      if (!title || !date) {
        status.innerText = "⚠️ Please fill all fields.";
        return;
      }

      await db.collection("events").add({
        title, desc, date, createdBy: currentUser.uid, createdAt: new Date()
      });

      status.innerText = `✅ Event "${title}" scheduled for ${date}.`;
      loadEvents();
    }

    // ---------------- Load Events ----------------
    async function loadEvents() {
      const eventList = document.getElementById('eventList');
      const eventsSnap = await db.collection("events").orderBy("date").get();
      if (eventsSnap.empty) {
        eventList.innerHTML = "<li>No upcoming events.</li>";
        return;
      }
      eventList.innerHTML = "";
      eventsSnap.forEach(doc => {
        const e = doc.data();
        eventList.innerHTML += `<li><strong>${e.title}</strong> — ${e.date}</li>`;
      });
    }

    // ---------------- Logout ----------------
    function logout() {
      auth.signOut().then(() => window.location.href = "login.html");
    }
  </script>
</body>
</html>
