<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pecos Trading Dashboard</title>
</head>
<body>
  <h2>Loading Zerodha login...</h2>
  <div id="status">Please wait...</div>

  <script type="module">
    import axios from "https://cdn.skypack.dev/axios";

    // Get the request_token from the redirected URL
    const params = new URLSearchParams(window.location.search);
    const request_token = params.get("request_token");

    if (!request_token) {
      document.getElementById("status").innerText = "No request_token found.";
    } else {
      document.getElementById("status").innerText = "Authenticating with Zerodha...";

      // ðŸ”— Send this token to your Firebase backend (youâ€™ll build this next)
      try {
        const response = await axios.post(
          "https://YOUR_FIREBASE_URL.cloudfunctions.net/getAccessToken",
          { request_token }
        );

        const { access_token } = response.data;
        localStorage.setItem("access_token", access_token);

        // Replace the screen with a simple demo trade panel
        document.body.innerHTML = `
          <h1>Pecos Trade Dashboard</h1>
          <p>Connected to Zerodha âœ…</p>
          <button id="buy">Buy INFY</button>
          <button id="sell">Sell INFY</button>
        `;

        document.getElementById("buy").onclick = async () => {
          await axios.post(
            "https://api.kite.trade/orders/regular",
            {
              exchange: "NSE",
              tradingsymbol: "INFY",
              transaction_type: "BUY",
              quantity: 1,
              order_type: "MARKET",
              product: "CNC",
            },
            {
              headers: {
                "X-Kite-Version": "3",
                Authorization: `token YOUR_API_KEY:${access_token}`,
              },
            }
          );
          alert("Buy order placed!");
        };
      } catch (err) {
        console.error(err);
        document.getElementById("status").innerText =
          "Login failed â€” check console for details.";
      }
    }
  </script>
</body>
</html>
